---
title: "Fall"
output:
  pdf_document: default
  html_notebook: default
  word_document: default
---





```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(rio)
library(tidyr)
library(dplyr)
library(stringr)
library(tableone)

## Loading the csv file

data.dir <- getOption("data.dir")
options(data.dir = "C:/Users/annan/OneDrive/Documents/GitHub/Fall_TITCo")
if (is.null(data.dir))
    stop ("Please set the directory where the data is kept using options(data.dir = \"<path to data directory>\")")

#TITCO dataset
titco_fall <- data.table::fread(file.path(data.dir,"titco-I-full-dataset-v1.csv"))


## Filter all fall patients
fall <- filter(titco_fall, moi == "Fall" )

## to find the sample size
dm <- nrow(fall)

## Find no and % of males and females
m <- fall$sex == "Male"
n.m <- sum(m)
p.m <- round(mean(m) * 100)
f <- fall$sex == "Female"
n.f <- sum(f)
p.f <- round(mean(f)*100)

## Summarize age
## Break age into groups
agebreaks <- c(17,25,45,65,98)
agelabels <- c("18-24","25-44","45-64","65+")

fall$age <- as.numeric(fall$age)

fall$agegrp <-cut(fall$age,
                breaks = agebreaks,
                right = FALSE,
                labels = agelabels)
table1 <- table(fall$agegrp)

## Find percentage transferred
t <- fall$tran == "Yes"
n.t <- sum(t,na.rm=T)
p.t <- round(mean(t,na.rm=T)*100)
## Find mode of transport 
am <- fall$mot == "Ambulance"
n.am <- sum(am,na.rm=T)
p.am <- round(mean(am,na.rm=T)*100)
## Find percentage of Type of injury
ti <- fall$ti == "Blunt"
n.ti <- sum(ti,na.rm=T)
p.ti <- round(mean(ti,na.rm=T)*100)

## Create GCS group
gcsbreaks <- c(2,8,13,15)
gcslabels <- c( "3-8", "9-13", "14-15")
fall$gcsgrp <-cut(fall$gcs_t_1,
                breaks = issbreaks,
                right = FALSE,
                labels = isslabels)
gcs.table <- table(gcsgroup)

## Find number of surgery done
tos <- fall$tos 
surg1<- ifelse(tos == 0, 0,
              ifelse(tos == 999, 0, 1))
surgery1 <- fall["Surgery"] <- surg1 == 1
n.s <- sum(surgery1, na.rm = TRUE)
p.s <- round(mean(surgery1, na.rm = TRUE)*100)

## Find mortality
died <- fall$died == "Yes"
n.died <- sum(died, na.rm = TRUE)
p.died <- round(mean(died, na.rm = TRUE) * 100)
## Find discharged against medical advice
dama <- fall$dama == "Yes"
n.dama <- sum(dama,na.rm = T)
p.dama <- round(mean(dama,na.rm = T)*100)

#ISS parameter value
issbreaks <- c(1,9,16,25,109)
isslabels <- c("Mild","Moderate","Severe","Profound")
fall$isspv <-cut(fall$iss,
                breaks = issbreaks,
                right = FALSE,
                labels = isslabels)

## Creating Table for TBI patients demography using table one
table1.data <- with(fall,
                    data.frame("Age" = age,
                               "Sex" = sex,
                               "Age group" = agegrp,
                               
                               "Type of injury" = ti,
                               "Mode of transport" = mot,
                               "Transferred" = ifelse(tran == "Yes", "Transferred", "Direct"),
                               "Systolic blood pressure" = sbp_1,
                               "Heart rate" = hr_1,
                               "Saturation" = spo2_1,
                               "Respiratory rate" = rr_1,
                               "Glasgow coma scale" = gcsgroup,
                               "Surgery" = ifelse(tos == "0", "Conservative", "Operative"),
                               "Mortality" = ifelse(died == "Yes", "Died", "Survived"),
                               check.names = FALSE
                               ))
a.table3 <- CreateTableOne(data=table1.data)
a.table3 <- knitr::kable(print(a.table3, caption = "Table 1. Characteristics of Fall Patients", showAllLevels = TRUE, printToggle = FALSE))

```

